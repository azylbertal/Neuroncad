Timer unit: 1e-06 s

Total time: 42.1891 s
File: nrn_net.py
Function: run_loop at line 182

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   182                                           @profile
   183                                           def run_loop(all_neurons):
   184                                               
   185         1           26     26.0      0.0      vmin=-70.
   186         1           15     15.0      0.0      vmax=80.   
   187         1           14     14.0      0.0      plot_len=300    
   188         1           14     14.0      0.0      fire_image_delay=100
   189         1           14     14.0      0.0      running=1
   190         1           13     13.0      0.0      plot_count=0
   191         1          124    124.0      0.0      buttons = pygame.sprite.Group()
   192         1           16     16.0      0.0      downflag=False;
   193         1           41     41.0      0.0      stop_button=pygame.sprite.Sprite()
   194         1          751    751.0      0.0      stop_button.image=pygame.image.load("stop.bmp").convert()
   195         1           31     31.0      0.0      stop_button.rect=stop_button.image.get_rect()
   196         1           30     30.0      0.0      stop_button.rect.x=width-stop_button.rect.width
   197         1           19     19.0      0.0      stop_button.rect.y=height-stop_button.rect.height
   198         1          101    101.0      0.0      buttons.add(stop_button)
   199                                           
   200         1          704    704.0      0.0      firing_neuron_image=pygame.image.load("firing_neuron.bmp").convert()
   201         1           44     44.0      0.0      firing_neuron_image.set_colorkey(WHITE)
   202         1          618    618.0      0.0      neuron_image=pygame.image.load("neuron.bmp").convert()
   203         1           32     32.0      0.0      neuron_image.set_colorkey(WHITE)
   204         1          106    106.0      0.0      plt=pygame.Surface((plot_len, 50))    
   205                                               
   206         1           16     16.0      0.0      APs=[]
   207         1           14     14.0      0.0      recv=[]
   208         1           13     13.0      0.0      dirty_recs=[]
   209                                               
   210         3          107     35.7      0.0      for counter, neur in enumerate(all_neurons.sprites()):
   211         2          241    120.5      0.0          recv+=[neuron.h.Vector()]
   212         2          162     81.0      0.0          recv[counter].record(neur.mod(0.5)._ref_v)
   213                                                   
   214                                               #v1=neuron.h.Vector()
   215                                               #v1.record(all_neurons.sprites()[0].mod(0.5)._ref_v)
   216                                               #v2=neuron.h.Vector()
   217                                               #v2.record(all_neurons.sprites()[1].mod(0.5)._ref_v)
   218                                           
   219                                               
   220         1         1026   1026.0      0.0      neuron.h.finitialize(-60)
   221         1       225106 225106.0      0.5      neuron.run(plot_len)
   222         1          382    382.0      0.0      v=np.ones(plot_len)*-60
   223         1          105    105.0      0.0      t=neuron.h.t
   224                                               
   225         1          848    848.0      0.0      screen.fill(bgcolor) 
   226         1          236    236.0      0.0      all_neurons.draw(screen)
   227         1          108    108.0      0.0      buttons.draw(screen)
   228         3           72     24.0      0.0      for neur in all_neurons.sprites():
   229         2         3022   1511.0      0.0          neur.drawAxons()
   230                                                   
   231         1          983    983.0      0.0      pygame.display.flip()
   232     13346       211321     15.8      0.5      while running:
   233                                                   
   234                                                   
   235                                           
   236     40038      1057247     26.4      2.5          for counter, neur in enumerate(all_neurons.sprites()):
   237                                                       
   238     26692       392100     14.7      0.9              try:       
   239     26692      5398209    202.2     12.8                  max_v=np.max(np.array(recv[counter]))
   240         2           36     18.0      0.0              except:
   241         2           31     15.5      0.0                  max_v=0
   242     26692       549995     20.6      1.3              if max_v>25.0 and neur.fire_counter==0:
   243       144         2353     16.3      0.0                  neur.fire_counter=fire_image_delay
   244       144         2204     15.3      0.0                  neur.image=firing_neuron_image
   245                                                           #dirty_recs.append(neur.rect)
   246       288         4788     16.6      0.0                  for ax in neur.axons:
   247       144         6613     45.9      0.0                      APs.append(AP(ax))
   248                                                           
   249     26692       433739     16.2      1.0              if neur.fire_counter>0:
   250                                                           
   251                                                           #neur.image=firing_neuron_image
   252     14400       249246     17.3      0.6                  neur.fire_counter-=1
   253     14400       228541     15.9      0.5                  if neur.fire_counter==0:
   254       144         2173     15.1      0.0                      neur.image=neuron_image
   255                                                               #dirty_recs.append(neur.rect)
   256                                                           
   257     13346       642676     48.2      1.5          event = pygame.event.poll()
   258     13346       351412     26.3      0.8          (x, y)=pygame.mouse.get_pos()    
   259     13346       249524     18.7      0.6          if event.type == pygame.QUIT:
   260                                                       return 0
   261                                                   
   262     13346       223012     16.7      0.5          if event.type == pygame.MOUSEBUTTONDOWN:
   263        23          347     15.1      0.0              downflag=True;
   264     13346       220959     16.6      0.5          if event.type == pygame.MOUSEMOTION:
   265       124         1845     14.9      0.0              if downflag:
   266                                                          
   267                                                           downflag=False;
   268                                                           #
   269                                               
   270     13346       221838     16.6      0.5          if event.type == pygame.MOUSEBUTTONUP:
   271                                                           
   272                                                           
   273        23          733     31.9      0.0              if stop_button.rect.collidepoint([x, y]):
   274                                                           
   275                                                           
   276         1           15     15.0      0.0                  return 0
   277        66         1767     26.8      0.0              for counter, neur in enumerate(all_neurons.sprites()):
   278        44         1104     25.1      0.0                  if neur.rect.collidepoint([x, y]):
   279        22         3900    177.3      0.0                          stm=neuron.h.IClamp(neur.mod(0.5))
   280        22         1430     65.0      0.0                          stm.delay=neuron.h.t#+step
   281        22          538     24.5      0.0                          stm.dur=10
   282        22          460     20.9      0.0                          stm.amp=10
   283                                                                  
   284                                                       
   285        22          350     15.9      0.0              downflag=False;
   286                                                   
   287                                                   #neuron.run(t)
   288                                                   
   289                                                   #t+=1
   290                                                   
   291                                                   
   292                                                   
   293                                                   
   294     13345      2356630    176.6      5.6          all_neurons.draw(screen)
   295                                           
   296     40035      1034490     25.8      2.5          for counter, neur in enumerate(all_neurons.sprites()):
   297                                                       #dirty_recs+=neur.drawAxons()
   298     26690       595075     22.3      1.4              dirty_recs.append(neur.rect)
   299     26690      1216137     45.6      2.9              recv[counter].resize(0)
   300                                                   
   301     96075      1496025     15.6      3.5          for ap in APs:
   302     82730      8229435     99.5     19.5              dirty_recs+=ap.draw_and_advance() 
   303     82730      1539008     18.6      3.6              if ap.pos==(ap.axon.len-1):
   304       137         6670     48.7      0.0                  APs.remove(ap)                
   305                                           
   306     13345      4445634    333.1     10.5          neuron.h.continuerun(t)
   307     13345       296718     22.2      0.7          t+=step         
   308                                                   
   309     13345      3594280    269.3      8.5          v=np.append(v[1::], [all_neurons.sprites()[0].mod(0.5).v])
   310     13345       256522     19.2      0.6          plot_count+=1
   311     13345       211271     15.8      0.5  	if plot_count==10:
   312      1334        19840     14.9      0.0  		plot_count=0
   313      1334       180065    135.0      0.4  		vmax=np.max(v)
   314      1334       184663    138.4      0.4          	vmin=np.min(v)-1
   315                                                   
   316      1334       289497    217.0      0.7          	v_scaled=50-49*(v-vmin)/(vmax-vmin)
   317                                                   
   318      1334       986009    739.1      2.3  		plist=np.vstack((np.array(range(plot_len)), v_scaled))
   319                                                   
   320      1334        91241     68.4      0.2          	plt.fill(bgcolor)
   321      1334      2205853   1653.6      5.2          	pygame.draw.lines(plt, BLUE, False, np.transpose(plist))
   322      1334       101863     76.4      0.2          	dirty_recs.append(screen.blit(plt, (100, 100)))
   323                                                   
   324     13345      1870169    140.1      4.4          pygame.display.update(dirty_recs)
   325     13345       286358     21.5      0.7          dirty_recs=[]

